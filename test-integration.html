<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Integra√ß√£o - Air Quality App</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .success { border-left: 4px solid #28a745; background: #d4edda; }
        .error { border-left: 4px solid #dc3545; background: #f8d7da; }
        .info { border-left: 4px solid #17a2b8; background: #d1ecf1; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 4px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Integra√ß√£o - Modern Air Quality App</h1>
    
    <div class="test-container info">
        <h2>üìã Status dos Testes</h2>
        <div id="testStatus">Aguardando execu√ß√£o dos testes...</div>
    </div>

    <div class="test-grid">
        <div class="test-container">
            <h3>üîß Teste de M√≥dulos</h3>
            <button onclick="testModuleLoading()">Testar Carregamento de M√≥dulos</button>
            <div id="moduleTest"></div>
        </div>

        <div class="test-container">
            <h3>üé® Teste de Componentes</h3>
            <button onclick="testComponents()">Testar Componentes UI</button>
            <div id="componentTest"></div>
        </div>

        <div class="test-container">
            <h3>üîÑ Teste de EventManager</h3>
            <button onclick="testEventManager()">Testar Sistema de Eventos</button>
            <div id="eventTest"></div>
        </div>

        <div class="test-container">
            <h3>üì± Teste Responsivo</h3>
            <button onclick="testResponsive()">Testar Responsividade</button>
            <div id="responsiveTest"></div>
        </div>
    </div>

    <div class="test-container">
        <h3>üìù Log de Execu√ß√£o</h3>
        <button onclick="clearLog()">Limpar Log</button>
        <button onclick="startIntegrationTest()">üöÄ Executar Teste Completo</button>
        <div id="testLog" class="log"></div>
    </div>

    <script>
        // Global test state
        let testResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('testLog');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        function updateTestStatus() {
            const statusElement = document.getElementById('testStatus');
            const total = testResults.length;
            const passed = testResults.filter(r => r.passed).length;
            const failed = total - passed;

            statusElement.innerHTML = `
                <strong>Total: ${total}</strong> | 
                <span style="color: green">Passou: ${passed}</span> | 
                <span style="color: red">Falhou: ${failed}</span> |
                <span style="color: blue">Taxa de Sucesso: ${total ? Math.round((passed/total)*100) : 0}%</span>
            `;
        }

        function addTestResult(name, passed, details = '') {
            testResults.push({ name, passed, details, timestamp: new Date() });
            updateTestStatus();
            log(`Teste "${name}": ${passed ? 'PASSOU' : 'FALHOU'} ${details}`, passed ? 'success' : 'error');
        }

        // Teste de carregamento de m√≥dulos
        async function testModuleLoading() {
            const resultDiv = document.getElementById('moduleTest');
            resultDiv.innerHTML = '<p>Testando carregamento de m√≥dulos...</p>';

            try {
                // Testa se os m√≥dulos podem ser importados
                const moduleTests = [
                    { name: 'main.js', path: './src/js/main.js' },
                    { name: 'EventManager', path: './src/js/utils/EventManager.js' },
                    { name: 'FormComponent', path: './src/js/views/components/FormComponent.js' }
                ];

                let results = [];
                
                for (const moduleTest of moduleTests) {
                    try {
                        const response = await fetch(moduleTest.path);
                        const exists = response.ok;
                        results.push(`${moduleTest.name}: ${exists ? '‚úÖ' : '‚ùå'}`);
                        addTestResult(`M√≥dulo ${moduleTest.name}`, exists, exists ? 'arquivo encontrado' : 'arquivo n√£o encontrado');
                    } catch (error) {
                        results.push(`${moduleTest.name}: ‚ùå (${error.message})`);
                        addTestResult(`M√≥dulo ${moduleTest.name}`, false, error.message);
                    }
                }

                resultDiv.innerHTML = `
                    <h4>Resultados:</h4>
                    <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red">Erro: ${error.message}</p>`;
                addTestResult('Carregamento de M√≥dulos', false, error.message);
            }
        }

        // Teste de componentes UI
        function testComponents() {
            const resultDiv = document.getElementById('componentTest');
            resultDiv.innerHTML = '<p>Testando elementos de UI...</p>';

            const components = [
                { name: 'Form Component', id: 'formComponent' },
                { name: 'Loading Component', id: 'loadingComponent' },
                { name: 'AQI Display Component', id: 'aqiDisplayComponent' },
                { name: 'Form Element', id: 'airQualityForm' },
                { name: 'City Input', id: 'city' },
                { name: 'State Input', id: 'state' }
            ];

            let results = [];
            
            components.forEach(component => {
                const element = document.getElementById(component.id);
                const exists = element !== null;
                results.push(`${component.name}: ${exists ? '‚úÖ' : '‚ùå'}`);
                addTestResult(`UI ${component.name}`, exists, exists ? 'elemento encontrado' : 'elemento n√£o encontrado');
            });

            resultDiv.innerHTML = `
                <h4>Elementos UI:</h4>
                <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
            `;
        }

        // Teste de EventManager (simulado)
        function testEventManager() {
            const resultDiv = document.getElementById('eventTest');
            resultDiv.innerHTML = '<p>Testando sistema de eventos...</p>';

            try {
                // Simula EventManager b√°sico
                class SimpleEventManager {
                    constructor() {
                        this.listeners = {};
                    }
                    
                    subscribe(event, callback) {
                        if (!this.listeners[event]) {
                            this.listeners[event] = [];
                        }
                        this.listeners[event].push(callback);
                    }
                    
                    publish(event, data) {
                        if (this.listeners[event]) {
                            this.listeners[event].forEach(callback => callback(data));
                        }
                    }
                }

                const eventManager = new SimpleEventManager();
                let eventReceived = false;

                // Testa publish/subscribe
                eventManager.subscribe('test:event', (data) => {
                    eventReceived = data === 'test-data';
                });

                eventManager.publish('test:event', 'test-data');

                const passed = eventReceived;
                addTestResult('EventManager Simulation', passed, passed ? 'pub/sub funcionando' : 'pub/sub falhou');

                resultDiv.innerHTML = `
                    <h4>Resultado:</h4>
                    <p>Sistema de Eventos: ${passed ? '‚úÖ Funcionando' : '‚ùå Falhou'}</p>
                    <p><small>Teste simulado - EventManager real seria carregado via m√≥dulos</small></p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red">Erro: ${error.message}</p>`;
                addTestResult('EventManager Simulation', false, error.message);
            }
        }

        // Teste de responsividade
        function testResponsive() {
            const resultDiv = document.getElementById('responsiveTest');
            resultDiv.innerHTML = '<p>Testando responsividade...</p>';

            const breakpoints = [
                { name: 'Mobile', width: 480 },
                { name: 'Tablet', width: 768 },
                { name: 'Desktop', width: 1200 }
            ];

            let results = [];
            
            breakpoints.forEach(bp => {
                // Simula teste de breakpoint
                const mediaQuery = window.matchMedia(`(max-width: ${bp.width}px)`);
                const responsive = typeof mediaQuery.matches === 'boolean';
                results.push(`${bp.name} (${bp.width}px): ${responsive ? '‚úÖ' : '‚ùå'}`);
                addTestResult(`Responsivo ${bp.name}`, responsive);
            });

            // Testa CSS Grid/Flexbox support
            const cssSupport = {
                grid: CSS.supports('display', 'grid'),
                flexbox: CSS.supports('display', 'flex'),
                customProperties: CSS.supports('color', 'var(--test)')
            };

            Object.entries(cssSupport).forEach(([feature, supported]) => {
                results.push(`CSS ${feature}: ${supported ? '‚úÖ' : '‚ùå'}`);
                addTestResult(`CSS ${feature}`, supported);
            });

            resultDiv.innerHTML = `
                <h4>Suporte Responsivo:</h4>
                <ul>${results.map(r => `<li>${r}</li>`).join('')}</ul>
                <p><strong>Tela Atual:</strong> ${window.innerWidth}x${window.innerHeight}px</p>
            `;
        }

        // Teste de integra√ß√£o completa
        async function startIntegrationTest() {
            log('üöÄ Iniciando teste de integra√ß√£o completa...', 'info');
            testResults = []; // Reset results
            
            log('üìã Fase 1: Testando carregamento de m√≥dulos...');
            await testModuleLoading();
            
            log('üé® Fase 2: Testando componentes UI...');
            testComponents();
            
            log('üîÑ Fase 3: Testando sistema de eventos...');
            testEventManager();
            
            log('üì± Fase 4: Testando responsividade...');
            testResponsive();
            
            log('üèÅ Teste de integra√ß√£o conclu√≠do!', 'success');
            
            // Sum√°rio final
            const total = testResults.length;
            const passed = testResults.filter(r => r.passed).length;
            const failed = total - passed;
            
            log(`üìä SUM√ÅRIO FINAL: ${passed}/${total} testes passaram (${Math.round((passed/total)*100)}%)`, 
                failed === 0 ? 'success' : 'error');
        }

        // Executa teste autom√°tico ao carregar
        window.onload = function() {
            log('üåü P√°gina de testes carregada');
            log('üí° Clique em "Executar Teste Completo" para verificar a integra√ß√£o');
            
            // Verifica se estamos na aplica√ß√£o principal
            if (window.location.pathname.includes('test')) {
                log('üìç Executando em modo de teste');
            } else {
                log('üìç Para testar a aplica√ß√£o principal, acesse index.html');
            }
        };
    </script>
</body>
</html>
